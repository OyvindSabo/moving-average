<!--
┏━━━━━━━┳━━━━━━━┳━┓   ┏━┳━┳━━━━━━━┳━━━━━━━┓
┃ ┏┓ ┏┓ ┃ ┏━━━┓ ┃ ┃   ┃ ┃ ┃ ┏━━━┓ ┃ ┏━━━━━┛
┃ ┃┃ ┃┃ ┃ ┃   ┃ ┃ ┃   ┃ ┃ ┃ ┃   ┃ ┃ ┃ ┏━━━┓
┃ ┃┃ ┃┃ ┃ ┃   ┃ ┃ ┗┓ ┏┛ ┃ ┃ ┃   ┃ ┃ ┃ ┗━┓ ┃
┃ ┃┃ ┃┃ ┃ ┗━━━┛ ┣┓ ┗━┛ ┏┫ ┃ ┃   ┃ ┃ ┗━━━┛ ┃
┣━┻┻━┻┻━╋━┳━━━┳━╋┻━━━━━┻╋━┻━┻━┓ ┣━┻━━━━━┳━┻━━━━━┳━━━━━━━┓
┃ ┏━━━┓ ┃ ┃   ┃ ┃ ┏━━━━━┫ ┏━┓ ┃ ┃ ┏━━━┓ ┃ ┏━━━━━┫ ┏━━━━━┛
┃ ┗━━━┛ ┃ ┃   ┃ ┃ ┗━━━━━┫ ┗━┛ ┗━┫ ┗━━━┛ ┃ ┃ ┏━━━┫ ┗━━━━━┓
┃ ┏━━━┓ ┃ ┗┓ ┏┛ ┃ ┏━━━━━┫ ┏━━━┓ ┃ ┏━━━┓ ┃ ┃ ┗━┓ ┃ ┏━━━━━┛
┃ ┃   ┃ ┣┓ ┗━┛ ┏┫ ┗━━━━━┫ ┃   ┃ ┃ ┃   ┃ ┃ ┗━━━┛ ┃ ┗━━━━━┓
┗━┛   ┗━┛┗━━━━━┛┗━━━━━━━┻━┛   ┗━┻━┛   ┗━┻━━━━━━━┻━━━━━━━┛
-->
<head>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
  />
  <!--
  ┏━━━━━━━┳━━━━━━━┳━┓   ┏━┳━┓     ┏━━━━━━━┳━━━━━━━┓
  ┃ ┏━━━━━┻━━┓ ┏━━┫ ┃   ┃ ┃ ┃     ┃ ┏━━━━━┫ ┏━━━━━┛
  ┃ ┗━━━━━┓  ┃ ┃  ┃ ┗━━━┛ ┃ ┃     ┃ ┗━━━━━┫ ┗━━━━━┓
  ┗━━━━━┓ ┃  ┃ ┃  ┗━━┓ ┏━━┫ ┃     ┃ ┏━━━━━┻━━━━━┓ ┃
  ┏━━━━━┛ ┃  ┃ ┃     ┃ ┃  ┃ ┗━━━━━┫ ┗━━━━━┳━━━━━┛ ┃
  ┗━━━━━━━┛  ┗━┛     ┗━┛  ┗━━━━━━━┻━━━━━━━┻━━━━━━━┛
  -->
  <style>
    body {
      background: #ecf0f1;
      margin: 0;
    }
    .header-style {
      background: white;
      padding: 20px;
    }
    .row-style {
      margin: 5px;
      display: flex;
    }
    .column-style {
      flex-grow: 1;
      flex-basis: 0;
    }
    .container-style {
      text-align: left;
      margin: 20px auto;
      padding: 20px;
      max-width: 720px;
      background: white;
      border-radius: 5px;
    }
    .shadow {
      box-shadow: 0 0 5px #bdc3c7;
    }
    .input-style {
      background: #ecf0f1;
      border: none;
      border-radius: 5px;
      outline: none;
      width: 100%;
    }
    .select-style {
      background: #ecf0f1;
      border: none;
      border-radius: 5px;
      outline: none;
      width: 100%;
    }
    .summary-style {
      font-size: 40px;
      font-family: Arial Black;
      color: #2c3e50;
      text-align: center;
      padding: 5px;
      margin: 5px;
    }
    .title-style {
      color: #2c3e50;
      padding: 5px;
      margin: 0px;
    }
    .text-style {
      font-size: 20px;
      font-family: Arial Black;
      color: #2c3e50;
      padding: 5px;
    }
    .menu-button-style {
      transition: 0.25s;
      cursor: pointer;
    }
    .menu-button-style.active {
      text-shadow: 0 0 1px;
    }
    .menu-button-style:hover {
      text-shadow: 0 0 1px;
    }
    .footer-style {
      box-sizing: border-box;
      text-align: center;
      position: fixed;
      padding: 20px;
      bottom: 0;
      left: 0;
      width: 100%;
    }
    .icon-style {
      color: #2c3e50;
      font-size: 40px;
    }
  </style>

  <!-- constants -->
  <script>
    const cryptocurrencies = {
      bitcoin: 'Bitcoin',
      ethereum: 'Ethereum',
      ripple: 'XRP',
      tether: 'Tether',
      'bitcoin-cash': 'Bitcoin Cash',
      litecoin: 'Litecoin',
      eos: 'EOS',
      binancecoin: 'Binance Coin',
      'bitcoin-cash-sv': 'Bitcoin SV',
      tezos: 'Tezos',
      cardano: 'Cardano',
      stellar: 'Stellar',
      'leo-token': 'LEO Token',
      tron: 'TRON',
      monero: 'Monero',
      cosmos: 'Cosmos',
      okb: 'OKB',
      chainlink: 'ChainLink',
      'huobi-token': 'Huobi Token',
      neo: 'NEO',
      'usd-coin': 'USD Coin',
      iota: 'IOTA',
      'ethereum-classic': 'Ethereum Classic',
      dash: 'Dash',
      'crypto-com-chain': 'Crypto.com Coin',
      ontology: 'Ontology',
      maker: 'Maker',
      vechain: 'VeChain',
      nem: 'NEM',
      dogecoin: 'Dogecoin',
      'paxos-standard': 'Paxos Standard',
      zcash: 'Zcash',
      'basic-attention-token': 'Basic Attention Token',
      decred: 'Decred',
      'true-usd': 'TrueUSD',
      qtum: 'Qtum',
      algorand: 'Algorand',
      havven: 'Synthetix Network Token',
      '0x': '0x',
      seele: 'Seele',
      ravencoin: 'Ravencoin',
      holotoken: 'Holo',
      bytom: 'Bytom',
      'nervos-network': 'Nervos Network',
      augur: 'Augur',
      'theta-token': 'Theta Network',
      waves: 'Waves',
      'bitcoin-gold': 'Bitcoin Gold',
      nano: 'Nano',
      omisego: 'OmiseGO',
    };

    const vsCurrencies = {
      aed: 'United Arab Emirates dirham',
      ars: 'Argentine peso',
      aud: 'Australian dollar',
      bch: 'Bitcoin Cash',
      bdt: 'Bangladeshi taka',
      bhd: 'Bahraini dinar',
      bmd: 'Bermudian dollar',
      bnb: 'Binance Coin',
      brl: 'Brazilian real',
      btc: 'Bitcoin',
      cad: 'Canadian dollar',
      chf: 'Swiss franc',
      clp: 'Chilean peso',
      cny: 'Renminbi',
      czk: 'Czech koruna',
      dkk: 'Danish krone',
      eos: 'EOS',
      eth: 'Ethereum',
      eur: 'Euro',
      gbp: 'Pound sterling',
      hkd: 'Hong Kong dollar',
      huf: 'Hungarian forint',
      idr: 'Indonesian rupiah',
      ils: 'Israeli new shekel',
      inr: 'Indian rupee',
      jpy: 'Japanese yen',
      krw: 'South Korean won',
      kwd: 'Kuwaiti dinar',
      lkr: 'Sri Lankan rupee',
      ltc: 'Litecoin',
      mmk: 'Burmese kyat',
      mxn: 'Mexican peso',
      myr: 'Malaysian ringgit',
      nok: 'Norwegian krone',
      nzd: 'New Zealand dollar',
      php: 'Philippine peso',
      pkr: 'Pakistani rupee',
      pln: 'Polish złoty',
      rub: 'Russian ruble',
      sar: 'Saudi riyal',
      sek: 'Swedish krona',
      sgd: 'Singapore dollar',
      thb: 'Thai baht',
      try: 'Turkish lira',
      twd: 'New Taiwan dollar',
      uah: 'Ukrainian hryvnia',
      usd: 'United States dollar',
      vef: 'Venezuelan bolívar',
      vnd: 'Vietnamese đồng',
      xag: 'Silver Ounce',
      xau: 'Gold Ounce',
      xdr: 'IMF Special Drawing Rights',
      xlm: 'Stellar',
      xrp: 'XRP',
      zar: 'South African rand',
    };
  </script>
  <!--
  ┏━┓   ┏━┳━━━━━━━┳━┳━┓     ┏━━━━━━━┓
  ┃ ┃   ┃ ┣━━┓ ┏━━┫ ┃ ┃     ┃ ┏━━━━━┛
  ┃ ┃   ┃ ┃  ┃ ┃  ┃ ┃ ┃     ┃ ┗━━━━━┓
  ┃ ┃   ┃ ┃  ┃ ┃  ┃ ┃ ┃     ┗━━━━━┓ ┃
  ┃ ┗━━━┛ ┃  ┃ ┃  ┃ ┃ ┗━━━━━┳━━━━━┛ ┃
  ┗━━━━━━━┛  ┗━┛  ┗━┻━━━━━━━┻━━━━━━━┛
  -->
  <script>
    const isValidView = view => ['sma', 'ema'].includes(view);

    const isValidCryptocurrency = (cryptocurrencyId, cryptocurrencies) =>
      Object.keys(cryptocurrencies).includes(cryptocurrencyId);

    const isValidVsCurrency = (vsCurrencyId, vsCurrencies) =>
      Object.keys(vsCurrencies).includes(vsCurrencyId);

    const isValidMovingAveragePeriod = movingAveragePeriod => {
      const parsedInt = parseInt(movingAveragePeriod);
      return (
        !isNaN(parsedInt) &&
        Number(movingAveragePeriod) === parsedInt &&
        parsedInt > 0 &&
        parsedInt <= 360
      );
    };

    const getParametersFromHash = hash =>
      hash
        .split('/')
        .filter(Boolean)
        .filter(element => element !== '#')
        .filter(element => element !== '#!');

    const getURIState = previousState => {
      if (!location.hash) return previousState;
      const parameters = getParametersFromHash(location.hash);
      if (parameters.length !== 4) return previousState;
      return {
        ...previousState,
        view: isValidView(parameters[0]) ? parameters[0] : previousState.view,
        cryptocurrencyId: isValidCryptocurrency(parameters[1], cryptocurrencies)
          ? parameters[1]
          : previousState.cryptocurrencyId,
        vsCurrencyId: isValidVsCurrency(parameters[2], vsCurrencies)
          ? parameters[2]
          : previousState.vsCurrencyId,
        movingAveragePeriod: isValidMovingAveragePeriod(parameters[3])
          ? parseInt(parameters[3])
          : previousState.movingAveragePeriod,
      };
    };

    const setUriFromState = ({
      view,
      cryptocurrencyId,
      vsCurrencyId,
      movingAveragePeriod,
    }) => {
      const hash = `#!/${view}/${cryptocurrencyId}/${vsCurrencyId}/${movingAveragePeriod}`;
      location.hash = hash;
    };

    const getViewTitle = title =>
      title === 'sma'
        ? 'Simple Moving Average (SMA)'
        : 'Exponential Moving Average (EMA)';

    const getValidatedMovingAveragePeriod = movingAveragePeriod =>
      Math.max(Math.min(movingAveragePeriod, 360), 1);

    const getSummary = (currentPrice, movingAverage, movingAveragePeriod) => {
      if (currentPrice === movingAverage) {
        return `The current price is equal to the ${movingAveragePeriod}-day moving average`;
      }
      const priceIsHigherThanMovingAverage = currentPrice > movingAverage;
      const differenceFactor = priceIsHigherThanMovingAverage
        ? (currentPrice / movingAverage - 1) * 100
        : (1 - currentPrice / movingAverage) * 100;
      const preposition = priceIsHigherThanMovingAverage ? 'above' : 'below';
      const color = priceIsHigherThanMovingAverage ? 'green' : 'red';
      const summaryMessage = `The current price is <span style="color:${color};">${differenceFactor.toFixed(
        2
      )}%</span> ${preposition} the ${movingAveragePeriod}-day moving average.`;
      return summaryMessage;
    };

    const getCurrentPrice = priceHistory =>
      priceHistory.length ? priceHistory.slice(-1)[0] : null;

    const getSimpleMovingAverage = (priceHistory, movingAveragePeriod) =>
      priceHistory.length
        ? priceHistory
            .slice(-movingAveragePeriod)
            .reduce((sum, price) => price + sum, 0) / movingAveragePeriod
        : null;

    // Based on https://stackoverflow.com/questions/40057020/calculating-exponential-moving-average-ema-using-javascript
    const getExponentialMovingAverage = (priceHistory, movingAveragePeriod) =>
      priceHistory
        .reduce(
          (emaArray, price, i) =>
            i
              ? emaArray.concat(
                  (2 * price) / (movingAveragePeriod + 1) +
                    (emaArray[emaArray.length - 1] *
                      (movingAveragePeriod - 1)) /
                      (movingAveragePeriod + 1)
                )
              : emaArray,
          [priceHistory[0]]
        )
        .slice(-1)[0];

    const getRandomPriceString = () => (Math.random() * 10000).toFixed(2);
  </script>
  <!--
  ┏━━━━━┓ ┏━━━━━━━┳━━━━━━━┳━┓   ┏━┳━━━━━━━┳━━━━━━━┳━━━━━┓ ┏━━━━━━━┓
  ┃ ┏━┓ ┃ ┃ ┏━━━━━┻┓ ┏━━┓ ┃ ┃   ┃ ┃ ┏━━━━━┫ ┏━━━━━┫ ┏━┓ ┃ ┃ ┏━━━━━┛
  ┃ ┗━┛ ┗━┫ ┗━━━━━┓┃ ┃  ┃ ┃ ┃   ┃ ┃ ┃     ┃ ┗━━━━━┫ ┗━┛ ┗━┫ ┗━━━━━┓
  ┃ ┏━━━┓ ┃ ┏━━━━━┛┃ ┃  ┃ ┃ ┃   ┃ ┃ ┃     ┃ ┏━━━━━┫ ┏━━━┓ ┣━━━━━┓ ┃
  ┃ ┃   ┃ ┃ ┗━━━━━┳┛ ┗━━┛ ┃ ┗━━━┛ ┃ ┗━━━━━┫ ┗━━━━━┫ ┃   ┃ ┣━━━━━┛ ┃
  ┗━┛   ┗━┻━━━━━━━┻━━━━━━━┻━━━━━━━┻━━━━━━━┻━━━━━━━┻━┛   ┗━┻━━━━━━━┛
  -->
  <script>
    const onNavigate = (previousState, detail) =>
      detail.view
        ? {
            ...previousState,
            view: detail.view,
          }
        : previousState;

    const onSetPriceHistory = (previousState, detail) =>
      detail.priceHistory
        ? {
            ...previousState,
            priceHistory: detail.priceHistory,
            isLoading: false,
          }
        : previousState;

    const onSetCryptocurrency = (previousState, detail) =>
      detail.cryptocurrencyId
        ? {
            ...previousState,
            cryptocurrencyId: detail.cryptocurrencyId,
            isLoading: true,
          }
        : previousState;

    const onSetVsCurrency = (previousState, detail) =>
      detail.vsCurrencyId.slice(-90)
        ? {
            ...previousState,
            vsCurrencyId: detail.vsCurrencyId,
            isLoading: true,
          }
        : previousState;

    const onSetMovingAveragePeriod = (previousState, detail) =>
      detail.movingAveragePeriod
        ? {
            ...previousState,
            movingAveragePeriod: getValidatedMovingAveragePeriod(
              detail.movingAveragePeriod
            ),
          }
        : previousState;
  </script>

  <!-- Side effects -->
  <script>
    const fetchPriceHistory = async state =>
      fetch(
        `https://api.coingecko.com/api/v3/coins/${state.cryptocurrencyId}/market_chart?vs_currency=${state.vsCurrencyId}&days=${state.days}`
      ).then(result =>
        result.json().then(({ prices: priceHistory }) => {
          window.dispatchEvent(
            new CustomEvent('SET_PRICE_HISTORY', {
              detail: { priceHistory: priceHistory.map(([_, price]) => price) },
            })
          );
        })
      );
    window.addEventListener('FETCH_PRICE_HISTORY', ({ detail }) => {
      fetchPriceHistory(detail.state);
    });
  </script>
  <!--
  ┏━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━┓ ┏━━━━━━━┓
  ┃ ┏━━━━━┻━━┓ ┏━━┫ ┏━━━┓ ┃ ┏━┓ ┃ ┃ ┏━━━━━┛
  ┃ ┗━━━━━┓  ┃ ┃  ┃ ┃   ┃ ┃ ┗━┛ ┗━┫ ┗━━━━━┓
  ┗━━━━━┓ ┃  ┃ ┃  ┃ ┃   ┃ ┃ ┏━━━┓ ┃ ┏━━━━━┛
  ┏━━━━━┛ ┃  ┃ ┃  ┃ ┗━━━┛ ┃ ┃   ┃ ┃ ┗━━━━━┓
  ┗━━━━━━━┛  ┗━┛  ┗━━━━━━━┻━┛   ┗━┻━━━━━━━┛
  -->
  <script>
    class Store {
      constructor() {
        this.state = {
          view: 'sma',
          days: 360,
          cryptocurrencyId: 'bitcoin',
          vsCurrencyId: 'usd',
          priceHistory: [],
          movingAveragePeriod: 30,
          isLoading: true,
        };
        this.setState(getURIState());

        window.addEventListener('hashchange', () => {
          this.setState(getURIState());
          this.renderInput(this.state);
        });

        // Bind actions to reducers
        window.addEventListener('NAVIGATE', ({ detail }) => {
          this.setState(onNavigate(this.state, detail));
        });
        window.addEventListener('SET_PRICE_HISTORY', ({ detail }) => {
          this.setState(onSetPriceHistory(this.state, detail));
        });
        window.addEventListener('SET_CRYPTOCURRENCY', ({ detail }) => {
          this.setState(onSetCryptocurrency(this.state, detail));
          window.dispatchEvent(
            new CustomEvent('FETCH_PRICE_HISTORY', {
              detail: { state: this.state },
            })
          );
        });
        window.addEventListener('SET_VS_CURRENCY', ({ detail }) => {
          this.setState(onSetVsCurrency(this.state, detail));
          window.dispatchEvent(
            new CustomEvent('FETCH_PRICE_HISTORY', {
              detail: { state: this.state },
            })
          );
        });
        window.addEventListener('SET_MOVING_AVERAGE_PERIOD', ({ detail }) => {
          this.setState(onSetMovingAveragePeriod(this.state, detail));
        });
        window.dispatchEvent(
          new CustomEvent('FETCH_PRICE_HISTORY', {
            detail: { state: this.state },
          })
        );
        this.renderInput(this.state);
      }

      setState(state) {
        Object.assign(this.state, state);
        setUriFromState(this.state);
        this.renderHeader(this.state);
        this.render(this.state);
      }

      renderHeader(state) {
        const smaMenuButton = document.getElementById('sma-menu-button');
        const emaMenuButton = document.getElementById('ema-menu-button');
        if (state.view === 'sma') {
          smaMenuButton.classList.add('active');
          emaMenuButton.classList.remove('active');
        } else if (state.view === 'ema') {
          smaMenuButton.classList.remove('active');
          emaMenuButton.classList.add('active');
        }
      }

      // Sets the correct initial input based on data from the url
      renderInput(state) {
        // Set the correct initial cryptocurrency input based on uri
        const indexOfSelectedCryptocurrency = Object.keys(
          cryptocurrencies
        ).indexOf(state.cryptocurrencyId);
        const cryptocurrencySelect = document.getElementById(
          'cryptocurrency-select'
        );
        cryptocurrencySelect.options.selectedIndex = indexOfSelectedCryptocurrency;

        // Set the correct initial vs currency input based on uri
        const indexOfSelectedVsCurrency = Object.keys(vsCurrencies).indexOf(
          state.vsCurrencyId
        );
        const vsCurrencySelect = document.getElementById('vs-currency-select');
        vsCurrencySelect.options.selectedIndex = indexOfSelectedVsCurrency;

        // Set the correct initial moving average period input based on uri
        const movingAveragePeriodInput = document.getElementById(
          'moving-average-period-input'
        );
        movingAveragePeriodInput.value = state.movingAveragePeriod;
      }

      render({ view, priceHistory, movingAveragePeriod, isLoading }) {
        // Render view title
        document.getElementById('view-title').innerHTML = getViewTitle(view);
        const currentPrice = getCurrentPrice(priceHistory);
        const getMovingAverage =
          view === 'sma' ? getSimpleMovingAverage : getExponentialMovingAverage;
        const movingAverage = getMovingAverage(
          priceHistory,
          movingAveragePeriod
        );
        if (isLoading) {
          // Repeatedly render random current price
          const randomCurrentPrice = getRandomPriceString();
          document.getElementById(
            'current-price'
          ).innerHTML = randomCurrentPrice;

          // Repeatedly render random moving average
          const randomMovingAverage = getRandomPriceString();
          document.getElementById(
            'current-moving-average'
          ).innerHTML = randomMovingAverage;

          if (currentPrice && movingAverage) {
            /* Render summary to handle the cases where the user updates the
             moving average period while new price data is still loading */
            const summary = getSummary(
              currentPrice,
              movingAverage,
              movingAveragePeriod
            );
            document.getElementById('summary').innerHTML = summary;
          }

          setTimeout(() => this.render(this.state), 0);
        } else {
          // Render current price
          document.getElementById(
            'current-price'
          ).innerHTML = currentPrice.toFixed(2);

          // Render moving average label
          document.getElementById(
            'current-moving-average-label'
          ).innerHTML = `${movingAveragePeriod}-day moving average:`;

          // Render moving average
          document.getElementById(
            'current-moving-average'
          ).innerHTML = movingAverage.toFixed(2);

          // Render summary
          const summary = getSummary(
            currentPrice,
            movingAverage,
            movingAveragePeriod
          );
          document.getElementById('summary').innerHTML = summary;
        }
      }
    }
  </script>
</head>
<!--
┏━┓   ┏━┳━━━━━━━┳━━━━━━━┳━┓
┃ ┃   ┃ ┣━━┓ ┏━━┫ ┏┓ ┏┓ ┃ ┃
┃ ┗━━━┛ ┃  ┃ ┃  ┃ ┃┃ ┃┃ ┃ ┃
┃ ┏━━━┓ ┃  ┃ ┃  ┃ ┃┃ ┃┃ ┃ ┃
┃ ┃   ┃ ┃  ┃ ┃  ┃ ┃┃ ┃┃ ┃ ┗━━━━━┓
┗━┛   ┗━┛  ┗━┛  ┗━┛┗━┛┗━┻━━━━━━━┛
  -->
<div class="header-style shadow">
  <span id="sma-menu-button" class="menu-button-style text-style">SMA</span
  ><span id="ema-menu-button" class="menu-button-style text-style">EMA</span>
</div>

<div id="widget-container" class="container-style shadow">
  <h1 id="view-title" class="title-style">Simple Moving Average (SMA)</h1>
  <div class="row-style">
    <div class="text-style column-style">Cryptocurrency</div>
    <div class="column-style">
      <select
        id="cryptocurrency-select"
        class="text-style column-style select-style"
      ></select>
    </div>
  </div>

  <div class="row-style">
    <div class="text-style column-style">vs. currency</div>
    <div class="column-style">
      <select
        id="vs-currency-select"
        class="text-style column-style select-style"
      >
      </select>
    </div>
  </div>

  <div class="row-style">
    <div class="text-style column-style">Moving average period:</div>
    <div class="column-style">
      <input
        id="moving-average-period-input"
        class="input-style text-style column-style"
        type="number"
        value="30"
      />
    </div>
  </div>

  <div class="row-style">
    <div class="text-style column-style">Current price:</div>
    <div id="current-price" class="text-style column-style"></div>
  </div>

  <div class="row-style">
    <div id="current-moving-average-label" class="text-style column-style">
      30-day moving average:
    </div>
    <div id="current-moving-average" class="text-style column-style"></div>
  </div>
</div>
<div id="summary" class="summary-style"></div>
<div class="footer-style">
  <a href="https://github.com/OyvindSabo/moving-average"
    ><i class="fa fa-github icon-style"></i><br
  /></a>
  <a href="https://www.coingecko.com/api/documentations/v3"
    >Powered by CoinGecko API</a
  >
</div>
<to the selects -->
  <script>
    const cryptocurrencySelect = document.getElementById(
      'cryptocurrency-select'
    );
    Object.entries(cryptocurrencies).forEach(([id, name]) => {
      const option = document.createElement('option');
      option.value = id;
      option.innerHTML = name;
      cryptocurrencySelect.appendChild(option);
    });

    const vsCurrencySelect = document.getElementById('vs-currency-select');
    Object.entries(vsCurrencies).forEach(([id, name]) => {
      const option = document.createElement('option');
      option.value = id;
      option.innerHTML = name;
      vsCurrencySelect.appendChild(option);
    });
  </script>

  <!-- Add change listeners to HTML -->
  <script>
    const smaMenuButton = document.getElementById('sma-menu-button');
    smaMenuButton.addEventListener('click', () => {
      window.dispatchEvent(
        new CustomEvent('NAVIGATE', { detail: { view: 'sma' } })
      );
    });

    const emaMenuButton = document.getElementById('ema-menu-button');
    emaMenuButton.addEventListener('click', () => {
      window.dispatchEvent(
        new CustomEvent('NAVIGATE', { detail: { view: 'ema' } })
      );
    });

    cryptocurrencySelect.addEventListener('change', () => {
      const cryptocurrencyId = cryptocurrencySelect.value;
      window.dispatchEvent(
        new CustomEvent('SET_CRYPTOCURRENCY', { detail: { cryptocurrencyId } })
      );
    });

    vsCurrencySelect.addEventListener('change', () => {
      const vsCurrencyId = vsCurrencySelect.value;
      window.dispatchEvent(
        new CustomEvent('SET_VS_CURRENCY', { detail: { vsCurrencyId } })
      );
    });

    const movingAveragePeriodInput = document.getElementById(
      'moving-average-period-input'
    );
    movingAveragePeriodInput.addEventListener('input', () => {
      const movingAveragePeriod = movingAveragePeriodInput.value;
      window.dispatchEvent(
        new CustomEvent('SET_MOVING_AVERAGE_PERIOD', {
          detail: { movingAveragePeriod },
        })
      );
    });
  </script>
  <script>
    const store = new Store();
  </script>
</to>
